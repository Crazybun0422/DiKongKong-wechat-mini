<view class="merchant-detail-page {{pageEntering ? 'merchant-detail-page--entering' : ''}} {{pageClosing ? 'merchant-detail-page--closing' : ''}}">
  <block wx:if="{{loading}}">
    <view class="merchant-detail-status">
      <text class="merchant-detail-status-text">加载中...</text>
    </view>
  </block>

  <block wx:elif="{{error}}">
    <view class="merchant-detail-status">
      <text class="merchant-detail-status-text">{{error}}</text>
      <button
        wx:if="{{markerId}}"
        class="merchant-detail-retry"
        bindtap="onRetry"
      >
        重试
      </button>
    </view>
  </block>

  <block wx:else>
    <scroll-view
      scroll-y
      class="marker-page-scroll"
      bindscroll="onDetailScroll"
      bindtouchstart="onDetailTouchStart"
      bindtouchmove="onDetailTouchMove"
      bindtouchend="onDetailTouchEnd"
      bindtouchcancel="onDetailTouchCancel"
    >
      <view class="marker-page-hero">
        <block wx:if="{{detail.images && detail.images.length}}">
          <swiper
            class="marker-page-swiper"
            autoplay="{{false}}"
            circular="{{true}}"
            bindchange="onSwiperChange"
            current="{{currentImage}}"
          >
            <block wx:for="{{detail.images}}" wx:key="id">
              <swiper-item>
                <image class="marker-page-swiper-image" src="{{item.url}}" mode="aspectFill" />
              </swiper-item>
            </block>
          </swiper>
          <view class="marker-page-swiper-dots" wx:if="{{detail.images && detail.images.length > 1}}">
            <block wx:for="{{detail.images}}" wx:key="id">
              <view class="marker-page-swiper-dot {{index === currentImage ? 'is-active' : ''}}"></view>
            </block>
          </view>
        </block>
        <view class="marker-page-hero-placeholder" wx:else>
          <text class="marker-page-hero-placeholder-text">暂无商户图片</text>
        </view>
      </view>

      <view class="marker-page-body">
        <view class="marker-page-header">
          <text class="marker-page-title">{{detail.name || '未命名商户'}}</text>
        </view>

        <view
          class="marker-page-honors"
          wx:if="{{detail.honors && detail.honors.length}}"
        >
          <block wx:for="{{detail.honors}}" wx:key="*this">
            <view class="marker-page-honor-chip">{{item}}</view>
          </block>
        </view>

        <view class="marker-page-address" wx:if="{{detail.locationText || detail.phone}}">
          <view class="marker-page-address-info" wx:if="{{detail.locationText}}">
            <text class="marker-page-address-label">地址</text>
            <text class="marker-page-address-text">{{detail.locationText}}</text>
          </view>
          <view class="marker-page-address-actions">

            <view
              class="marker-page-action"
              wx:if="{{detail.latitude && detail.longitude}}"
              data-latitude="{{detail.latitude}}"
              data-longitude="{{detail.longitude}}"
              data-name="{{detail.name || '商户位置'}}"
              data-address="{{detail.locationText || ''}}"
              bindtap="onNavigateTap"
            >
              <view class="marker-page-action-icon">
                <image class="marker-page-action-image" src="/assets/m-target.png" mode="aspectFit" />
              </view>
              <text class="marker-page-action-label">地图</text>
            </view>
            <view
              class="marker-page-action"
              wx:if="{{detail.phone}}"
              data-phone="{{detail.phone}}"
              data-marker-id="{{detail.markerId || detail.id || ''}}"
              bindtap="onCallPhone"
            >
              <view class="marker-page-action-icon">
                <image class="marker-page-action-image" src="/assets/m-telephone.png" mode="aspectFit" />
              </view>
              <text class="marker-page-action-label">电话</text>
            </view>
          </view>
        </view>

        <view class="marker-page-section">
          <text class="marker-page-section-title">简介</text>
          <text class="marker-page-section-text" wx:if="{{detail.description}}">
            {{detail.description}}
          </text>
          <text class="marker-page-section-text marker-page-section-text--placeholder" wx:else>
            暂无简介
          </text>
        </view>

        <view
          class="marker-page-section"
          wx:if="{{detail.attachments && detail.attachments.length}}"
        >
          <text class="marker-page-section-title">附件</text>
          <view class="marker-page-link-list">
            <block wx:for="{{detail.attachments}}" wx:key="id">
              <view
                class="marker-page-link-item"
                data-url="{{item.url}}"
                bindtap="onAttachmentTap"
              >
                <view class="marker-page-link-info">
                  <text class="marker-page-link-text">{{item.shortName || item.displayName || item.fileName || '附件'}}</text>
                  <text class="marker-page-link-arrow">></text>
                </view>
                <image class="marker-page-link-icon" src="/assets/f-download.png" mode="aspectFit" />
              </view>
            </block>
          </view>
        </view>

        <block wx:if="{{detail.videoAccounts && detail.videoAccounts.length}}">
          <block wx:for="{{detail.videoAccounts}}" wx:key="id">
            <view
              class="marker-page-link-item marker-page-link-item--video"
              data-url="{{item.url || ''}}"
              data-finder="{{item.finderUserName || ''}}"
              data-activity="{{item.activityId || ''}}"
              bindtap="onVideoTap"
            >
              <view class="marker-page-link-info marker-page-link-info--video">
                <text class="marker-page-link-text">{{detail.videoAccounts.length > 1 ? ('视频号内容 ' + (index + 1)) : '丰富的视频案例介绍'}}</text>
                <text class="marker-page-link-arrow">></text>
              </view>
              <image class="marker-page-link-icon marker-page-link-icon--right" src="/assets/v-account.png" mode="aspectFit" />
            </view>
          </block>
        </block>

        <view
          class="marker-page-qrcode-wrapper"
          wx:if="{{detail.qrCodes && detail.qrCodes.length}}"
        >
          <image class="marker-page-qrcode" src="{{detail.qrCodes[0].url}}" mode="aspectFit" />
        </view>
      </view>
    </scroll-view>

    <block wx:if="{{shareEnabled}}">
      <button open-type="share" class="marker-page-share">
        <image class="marker-page-share-icon" src="/assets/tansmit.png" mode="aspectFit" />
        <text class="marker-page-share-text">转发</text>
      </button>
    </block>
    <block wx:else>
      <button class="marker-page-share marker-page-share--disabled" bindtap="onShareDisabledTap">
        <image class="marker-page-share-icon" src="/assets/tansmit.png" mode="aspectFit" />
        <text class="marker-page-share-text">转发</text>
      </button>
    </block>
    <view class="marker-page-close-hint">下滑关闭详情</view>
  </block>
</view>
