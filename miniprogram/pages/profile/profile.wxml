<view class="profile-page">
  <scroll-view scroll-y="true" class="profile-scroll">
    <block wx:if="{{loading}}">
      <view class="profile-loading">加载中...</view>
    </block>
    <block wx:elif="{{error}}">
      <view class="profile-error">
        <text>{{error}}</text>
        <button class="profile-retry-btn" bindtap="onRetryTap">重试</button>
      </view>
    </block>
    <block wx:else>
      <view class="profile-content">
        <view class="profile-header-card" bindtap="onEditProfileTap">
          <image
            class="profile-avatar"
            src="{{profile.avatarUrl || defaultAvatar}}"
            mode="aspectFill"
          />
          <view class="profile-header-body">
            <view class="profile-name-row">
              <text class="profile-name">{{profile.nickname}}</text>
              <text class="profile-arrow">›</text>
            </view>
            <view class="profile-code-row">
              <text class="profile-code-label">低空号</text>
              <text class="profile-code-value">{{profile.featureCode}}</text>
              <view class="profile-code-copy" catchtap="onCopyFeatureCode">复制</view>
            </view>
          </view>
        </view>

        <view class="profile-card" bindtap="onFlpCardTap">
          <view class="profile-card-left">
            <text class="profile-card-title">FLP</text>
            <text class="profile-card-value">{{profile.flpDisplay}}</text>
          </view>
          <text class="profile-card-arrow">›</text>
        </view>

        <view class="profile-section">
          <view class="profile-section-title">权益+</view>
          <view class="profile-list">
            <view
              class="profile-list-item"
              hover-class="profile-list-item-hover"
              data-action="markers"
              bindtap="onListItemTap"
            >
              <view class="profile-list-left">
                <text class="profile-list-text">我的标记</text>
                <text class="profile-list-tag">内测中</text>
              </view>
              <text class="profile-list-arrow">›</text>
            </view>
            <view
              class="profile-list-item"
              hover-class="profile-list-item-hover"
              data-action="customer-service"
              bindtap="onListItemTap"
            >
              <view class="profile-list-left">
                <text class="profile-list-text">客服</text>
              </view>
              <text class="profile-list-arrow">›</text>
            </view>
            <view
              class="profile-list-item"
              hover-class="profile-list-item-hover"
              data-action="open-platform"
              bindtap="onListItemTap"
            >
              <view class="profile-list-left">
                <text class="profile-list-text">开放平台</text>
                <text class="profile-list-tag">插件 / API</text>
              </view>
              <text class="profile-list-arrow">›</text>
            </view>
          </view>
        </view>

        <text class="profile-footnote">拉起小程序客服，敬请期待更多服务。</text>
      </view>
    </block>
  </scroll-view>

  <view class="bottom-controls">
    <view class="bottom-menu">
      <button
        class="menu-btn {{activeTab === 'home' ? 'is-active' : ''}}"
        bindtap="onMenuHomeTap"
      >
        <image class="menu-icon" src="/assets/home.png" mode="aspectFit" />
      </button>
      <button
        class="menu-btn {{activeTab === 'profile' ? 'is-active' : ''}}"
        bindtap="onMenuProfileTap"
      >
        <image class="menu-icon" src="/assets/profile.png" mode="aspectFit" />
      </button>
    </view>

    <button class="chat-fab" hover-class="chat-fab-hover" bindtap="onChatButtonTap">
      <image class="chat-fab-icon" src="/assets/ai-chat.png" mode="aspectFit" />
    </button>
  </view>
</view>
