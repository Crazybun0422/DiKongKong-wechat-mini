<view class="profile-page">
  <scroll-view scroll-y="true" class="profile-scroll">
    <block wx:if="{{loading}}">
      <view class="profile-loading">加载中...</view>
    </block>
    <block wx:elif="{{error}}">
      <view class="profile-error">
        <text>{{error}}</text>
        <button class="profile-retry-btn" bindtap="onRetryTap">重试</button>
      </view>
    </block>
    <block wx:else>
        <view class="profile-content">
        <view class="profile-header-card">
          <button
            class="profile-avatar-button"
            open-type="chooseAvatar"
            bindchooseavatar="onChooseAvatar"
          >
            <image
              class="profile-avatar"
              src="{{profile.avatarUrl || defaultAvatar}}"
              mode="aspectFill"
            />
            <view class="avatar-overlay">
              <text>更换</text>
            </view>
          </button>
          <view class="profile-header-body">
            <view class="profile-name-row">
              <block wx:if="{{nicknameEditing}}">
                <input
                  class="profile-name-input"
                  type="nickname"
                  value="{{nicknameInput}}"
                  bindinput="onNicknameInputChange"
                  bindconfirm="onNicknameInputConfirm"
                  confirm-type="done"
                  focus="{{nicknameEditing}}"
                  catchtap="onNicknameInputTap"
                  placeholder="编辑昵称"
                />
              </block>
              <block wx:else>
                <text class="profile-name" bindtap="startNicknameEdit">{{profile.nickname}}</text>
                <text class="profile-name-edit" bindtap="startNicknameEdit">点击修改</text>
              </block>
            </view>
            <view class="profile-code-row">
              <text class="profile-code-label">低空号</text>
              <text class="profile-code-value">{{profile.featureCode}}</text>
            </view>
          </view>
        </view>

        <view class="profile-card" bindtap="onFlpCardTap">
          <view class="profile-card-left">
            <text class="profile-card-title">FLP</text>
            <text class="profile-card-value">{{profile.flpDisplay}}</text>
          </view>
          <text class="profile-card-arrow">›</text>
        </view>

        <view class="profile-section">
          <view class="profile-section-title">权益+</view>
          <view class="profile-list">
            <view
              class="profile-list-item"
              hover-class="profile-list-item-hover"
              data-action="markers"
              bindtap="onListItemTap"
            >
              <view class="profile-list-left">
                <text class="profile-list-text">我的标记</text>
                <!-- <text class="profile-list-tag">内测中</text> -->
              </view>
              <text class="profile-list-arrow">›</text>
            </view>
            <button
              class="profile-list-item profile-list-item-contact"
              hover-class="profile-list-item-hover"
              open-type="contact"
              bindcontact="onCustomerServiceContact"
              session-from="{{customerServiceSessionFrom}}"
            >
              <view class="profile-list-left">
                <text class="profile-list-text">客服</text>
              </view>
              <text class="profile-list-arrow">›</text>
            </button>
            <view
              class="profile-list-item"
              hover-class="profile-list-item-hover"
              data-action="open-platform"
              bindtap="onListItemTap"
            >
              <view class="profile-list-left">
                <text class="profile-list-text">开放平台</text>
                <text class="profile-list-tag">插件 / API</text>
              </view>
              <text class="profile-list-arrow">›</text>
            </view>
          </view>
        </view>

        <!-- <text class="profile-footnote">鎷夎捣灏忕▼搴忓鏈嶏紝鏁鏈熷緟鏇村鏈嶅姟銆?/text> -->
      </view>
    </block>
  </scroll-view>

  <view class="bottom-controls">
    <view class="bottom-menu">
      <button
        class="menu-btn {{activeTab === 'home' ? 'is-active' : ''}}"
        bindtap="onMenuHomeTap"
      >
        <image class="menu-icon" src="/assets/home.png" mode="aspectFit" />
      </button>
      <button
        class="menu-btn {{activeTab === 'profile' ? 'is-active' : ''}}"
        bindtap="onMenuProfileTap"
      >
        <image class="menu-icon" src="/assets/profile.png" mode="aspectFit" />
      </button>
    </view>

    <button class="chat-fab" hover-class="chat-fab-hover" bindtap="onChatButtonTap">
      <image class="chat-fab-icon" src="/assets/ai-chat.png" mode="aspectFit" />
    </button>
  </view>
</view>

